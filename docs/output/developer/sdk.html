<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="/datamaker/docs/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/datamaker/docs/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-5DXHX186GN"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-5DXHX186GN'); </script> <script type="text/javascript" src="/datamaker/docs/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/datamaker/docs/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>SDK | Datamaker Docs</title> <meta name="generator" content="Jekyll v4.1.1" /> <meta property="og:title" content="SDK" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation" /> <meta property="og:description" content="Documentation" /> <link rel="canonical" href="https://www.datamaker.ai/datamaker/docs/developer/sdk.html" /> <meta property="og:url" content="https://www.datamaker.ai/datamaker/docs/developer/sdk.html" /> <meta property="og:site_name" content="Datamaker Docs" /> <script type="application/ld+json"> {"@type":"WebPage","url":"https://www.datamaker.ai/datamaker/docs/developer/sdk.html","headline":"SDK","description":"Documentation","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://www.datamaker.ai/datamaker/docs/assets/img/datamaker.svg"}},"@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="https://www.datamaker.ai/datamaker/docs/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://www.datamaker.ai/datamaker/docs/admin/" class="nav-list-link">Admin</a><ul class="nav-list "><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/admin/install.html" class="nav-list-link">Installation</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/admin/auth.html" class="nav-list-link">Authentication</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/admin/configuration.html" class="nav-list-link">Configuration</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/admin/database.html" class="nav-list-link">Database</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/admin/file_manager.html" class="nav-list-link">File Manager</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/admin/security.html" class="nav-list-link">Security</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/admin/troubleshooting.html" class="nav-list-link">Troubleshooting</a></li></ul></li><li class="nav-list-item"><a href="https://www.datamaker.ai/datamaker/docs/architecture/" class="nav-list-link">Architecture</a></li><li class="nav-list-item"><a href="https://www.datamaker.ai/datamaker/docs/contact/" class="nav-list-link">Contact</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://www.datamaker.ai/datamaker/docs/dev/" class="nav-list-link">Developer</a><ul class="nav-list "><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/developer/rest_api.html" class="nav-list-link">Rest API</a></li><li class="nav-list-item active"><a href="https://www.datamaker.ai/datamaker/docs/developer/sdk.html" class="nav-list-link active">SDK</a></li></ul></li><li class="nav-list-item"><a href="https://www.datamaker.ai/datamaker/docs/notes/" class="nav-list-link">Release Notes</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://www.datamaker.ai/datamaker/docs/user/" class="nav-list-link">User</a><ul class="nav-list "><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/user/getting_started.html" class="nav-list-link">Getting Started</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/user/getting_started_ami.html" class="nav-list-link">Getting Started AMI</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/user/datasets.html" class="nav-list-link">Datasets</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/user/expression_language.html" class="nav-list-link">Expression Language</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/user/field_mappings.html" class="nav-list-link">Field Mappings</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/user/fields.html" class="nav-list-link">Fields</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/user/formatters.html" class="nav-list-link">Formatters</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/user/generators.html" class="nav-list-link">Generators</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/user/jobs.html" class="nav-list-link">Jobs</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/user/sinks.html" class="nav-list-link">Sinks</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/user/users.html" class="nav-list-link">Users</a></li><li class="nav-list-item "><a href="https://www.datamaker.ai/datamaker/docs/user/workspaces.html" class="nav-list-link">Workspaces</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Datamaker Docs" aria-label="Search Datamaker Docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="https://www.datamaker.ai/datamaker/docs/dev/">Developer</a></li> <li class="breadcrumb-nav-list-item"><span>SDK</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="sdk"> <a href="#sdk" class="anchor-heading" aria-labelledby="sdk"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SDK </h1> <h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents </h2> <ol id="markdown-toc"> <li><a href="#how-to-extend-functionalities" id="markdown-toc-how-to-extend-functionalities">How to extend functionalities</a></li> <li><a href="#processor" id="markdown-toc-processor">Processor</a> <ol> <li><a href="#code-sample" id="markdown-toc-code-sample">Code sample</a></li> <li><a href="#base-class" id="markdown-toc-base-class">Base class</a></li> </ol> </li> <li><a href="#sink" id="markdown-toc-sink">Sink</a> <ol> <li><a href="#code-sample-1" id="markdown-toc-code-sample-1">Code sample</a></li> <li><a href="#interface-class" id="markdown-toc-interface-class">Interface class</a></li> </ol> </li> <li><a href="#field" id="markdown-toc-field">Field</a> <ol> <li><a href="#code-sample-2" id="markdown-toc-code-sample-2">Code sample</a></li> <li><a href="#base-class-1" id="markdown-toc-base-class-1">Base class</a></li> </ol> </li> <li><a href="#generator" id="markdown-toc-generator">Generator</a> <ol> <li><a href="#code-sample-3" id="markdown-toc-code-sample-3">Code sample</a></li> <li><a href="#interface-class-1" id="markdown-toc-interface-class-1">Interface class</a></li> </ol> </li> </ol> <h2 id="how-to-extend-functionalities"> <a href="#how-to-extend-functionalities" class="anchor-heading" aria-labelledby="how-to-extend-functionalities"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How to extend functionalities </h2> <ul> <li>Create basic Maven project</li> </ul> <p><code class="language-plaintext highlighter-rouge">mvn archetype:generate -DgroupId=ai.datamaker -DartifactId=demo-sdk -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false</code></p> <ul> <li>Make sure the library (jar) is installed in your local or remote repository (Nexus, Artefactory)</li> <li>Add Datamaker dependency to pom.xml</li> </ul> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>ai.datamaker<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>service<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0.6<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div> <ul> <li>Build: <code class="language-plaintext highlighter-rouge">mvn clean install</code></li> <li>Make sure there are no compile errors</li> <li>From there you can create custom components to enrich your Datamaker instance</li> <li>When you are done developing, you can copy the target jar on the server running datamaker in the following path <ul> <li>loader path: <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># APPLICATION FILES</span>
<span class="s">application.config.path=/tmp/datamaker/conf</span>
<span class="s">loader.path=${application.config.path}/jar</span>
</code></pre></div> </div> </li> </ul> </li> <li>Make sure your copy all dependencies required by your library</li> <li>Restart the service</li> </ul> <h2 id="processor"> <a href="#processor" class="anchor-heading" aria-labelledby="processor"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Processor </h2> <p>The processors are mainly used to automatically create datasets from well-known file formats. For example, if we have a CSV file that we want to process, we can use the CsvProcessor. This processor will use the headers and values to create the corresponding dataset. A processor takes an InputStream and convert it to a dataset using the provided configuration.</p> <p>Minimally you need to implement these two methods:</p> <p><code class="language-plaintext highlighter-rouge">public abstract Optional&lt;Dataset&gt; process(InputStream input, JobConfig config);</code></p> <p><code class="language-plaintext highlighter-rouge">public abstract Set&lt;SupportedMediaType&gt; supportedTypes();</code></p> <p>Let say we have a custom format that we want to process. This file used a basic structure such as TLV (Tag-Length-Value) triplets.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1 byte  = record type
4 bytes = record length
followed by record content
</code></pre></div></div> <h3 id="code-sample"> <a href="#code-sample" class="anchor-heading" aria-labelledby="code-sample"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Code sample </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Dataset</span><span class="o">&gt;</span> <span class="nf">process</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">input</span><span class="o">,</span> <span class="nc">JobConfig</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Locale</span> <span class="n">locale</span> <span class="o">=</span> <span class="n">getLocale</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">datasetName</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span><span class="n">config</span><span class="o">.</span><span class="na">getConfigProperty</span><span class="o">(</span><span class="no">INPUT_FILENAME_PROPERTY</span><span class="o">);</span>

        <span class="nc">Dataset</span> <span class="n">dataset</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Dataset</span><span class="o">(</span><span class="n">datasetName</span><span class="o">,</span><span class="n">locale</span><span class="o">);</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">position</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">type</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
                <span class="n">position</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">;</span>
                <span class="kt">byte</span><span class="o">[]</span> <span class="n">lengthBuffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">4</span><span class="o">];</span>
                <span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">lengthBuffer</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">4</span><span class="o">);</span>
                <span class="n">position</span> <span class="o">+=</span> <span class="mi">3</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="nc">ByteBuffer</span><span class="o">.</span><span class="na">wrap</span><span class="o">(</span><span class="n">lengthBuffer</span><span class="o">).</span><span class="na">getInt</span><span class="o">();</span>
                <span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">length</span><span class="o">];</span>
                <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">content</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">length</span><span class="o">);</span>
                <span class="n">position</span> <span class="o">+=</span> <span class="n">length</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">IntegerField</span> <span class="n">integerField</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IntegerField</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">content</span><span class="o">),</span> <span class="n">locale</span><span class="o">);</span>
                    <span class="n">dataset</span><span class="o">.</span><span class="na">addField</span><span class="o">(</span><span class="n">integerField</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">StringField</span> <span class="n">stringField</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringField</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">content</span><span class="o">),</span> <span class="n">locale</span><span class="o">);</span>
                    <span class="n">dataset</span><span class="o">.</span><span class="na">addField</span><span class="o">(</span><span class="n">stringField</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">DatasetSerializationException</span><span class="o">(</span><span class="s">"invalid data"</span><span class="o">,</span> <span class="n">e</span><span class="o">,</span> <span class="n">dataset</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="k">return</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">dataset</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></div></div> <h3 id="base-class"> <a href="#base-class" class="anchor-heading" aria-labelledby="base-class"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Base class </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">ca.breakpoints.datamaker.processor</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.field.Field</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.service.FieldDetectorService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>

<span class="cm">/**
 * Process input source to generate dataset automatically.
 * Determine data type based on values.
 * Apply default rules.
 */</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">DatasetProcessor</span> <span class="kd">implements</span> <span class="nc">Configurable</span> <span class="o">{</span>

    <span class="kd">static</span> <span class="kd">final</span> <span class="nc">PropertyConfig</span> <span class="no">LOCALE_PROPERTY</span> <span class="o">=</span>
            <span class="k">new</span> <span class="nf">PropertyConfig</span><span class="o">(</span><span class="nc">Constants</span><span class="o">.</span><span class="na">LOCALE</span><span class="o">,</span>
                               <span class="s">"Locale"</span><span class="o">,</span>
                               <span class="nc">PropertyConfig</span><span class="o">.</span><span class="na">ValueType</span><span class="o">.</span><span class="na">STRING</span><span class="o">,</span>
                               <span class="nc">Locale</span><span class="o">.</span><span class="na">ENGLISH</span><span class="o">.</span><span class="na">toLanguageTag</span><span class="o">(),</span>
                               <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="nc">Locale</span><span class="o">.</span><span class="na">ENGLISH</span><span class="o">.</span><span class="na">toLanguageTag</span><span class="o">(),</span> <span class="nc">Locale</span><span class="o">.</span><span class="na">FRENCH</span><span class="o">.</span><span class="na">toLanguageTag</span><span class="o">()));</span>

    <span class="kd">static</span> <span class="kd">final</span> <span class="nc">PropertyConfig</span> <span class="no">INPUT_FILENAME_PROPERTY</span> <span class="o">=</span>
            <span class="k">new</span> <span class="nf">PropertyConfig</span><span class="o">(</span><span class="nc">Constants</span><span class="o">.</span><span class="na">INPUT_FILENAME_KEY</span><span class="o">,</span>
                               <span class="s">"Input filename"</span><span class="o">,</span>
                               <span class="nc">PropertyConfig</span><span class="o">.</span><span class="na">ValueType</span><span class="o">.</span><span class="na">STRING</span><span class="o">,</span>
                               <span class="s">""</span><span class="o">,</span>
                               <span class="nc">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">());</span>

    <span class="kd">public</span> <span class="nc">Locale</span> <span class="nf">getLocale</span><span class="o">(</span><span class="nc">JobConfig</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="nc">Locale</span><span class="o">.</span><span class="na">forLanguageTag</span><span class="o">((</span><span class="nc">String</span><span class="o">)</span> <span class="n">config</span><span class="o">.</span><span class="na">getConfigProperty</span><span class="o">(</span><span class="no">LOCALE_PROPERTY</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@Autowired</span>
    <span class="kd">protected</span> <span class="nc">FieldDetectorService</span> <span class="n">fieldDetectorService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Dataset</span><span class="o">&gt;</span> <span class="nf">process</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">process</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="nc">JobConfig</span><span class="o">.</span><span class="na">EMPTY</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Dataset</span><span class="o">&gt;</span> <span class="nf">process</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">input</span><span class="o">,</span> <span class="nc">JobConfig</span> <span class="n">config</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">SupportedMediaType</span><span class="o">&gt;</span> <span class="nf">supportedTypes</span><span class="o">();</span>

    <span class="kd">protected</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Field</span><span class="o">&gt;</span> <span class="nf">detectField</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">values</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h1 id="sink"> <a href="#sink" class="anchor-heading" aria-labelledby="sink"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sink </h1> <p>A sink is the last link in the chain. It sends the data to one or multiple receivers.</p> <p>You must implement these methods:</p> <p><code class="language-plaintext highlighter-rouge">boolean accept(FormatType type);</code></p> <p><code class="language-plaintext highlighter-rouge">OutputStream getOutputStream(JobConfig config) throws Exception;</code></p> <p><code class="language-plaintext highlighter-rouge">List&lt;PropertyConfig&gt; getConfigProperties();</code></p> <h3 id="code-sample-1"> <a href="#code-sample-1" class="anchor-heading" aria-labelledby="code-sample-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Code sample </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">ca.breakpoints.datamaker.sink.base</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.generator.FormatType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.DataOutputSinkType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.JobConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.PropertyConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.PropertyConfig.ValueType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.job.JobExecution</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.sink.DataOutputSink</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.collect.Lists</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
 * Will generate a downloadable file.
 */</span>
<span class="nd">@Slf4j</span>
<span class="nd">@DataOutputSinkType</span><span class="o">(</span><span class="n">compressed</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">encrypted</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileOutputSink</span> <span class="kd">implements</span> <span class="nc">DataOutputSink</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">PropertyConfig</span> <span class="no">FILE_OUTPUT_PATH_PROPERTY</span>
        <span class="o">=</span> <span class="k">new</span> <span class="nc">PropertyConfig</span><span class="o">(</span>
        <span class="s">"file.sink.output.filename"</span><span class="o">,</span>
        <span class="s">"Output file path"</span><span class="o">,</span>
        <span class="nc">ValueType</span><span class="o">.</span><span class="na">EXPRESSION</span><span class="o">,</span>
        <span class="s">"\"/tmp/\" + #dataset.name + \"-\" + T(java.lang.System).currentTimeMillis() + \".\" + #dataJob.generator.dataType.name().toLowerCase()"</span><span class="o">,</span>
        <span class="nc">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">());</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">accept</span><span class="o">(</span><span class="nc">FormatType</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">PropertyConfig</span><span class="o">&gt;</span> <span class="nf">getConfigProperties</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Lists</span><span class="o">.</span><span class="na">newArrayList</span><span class="o">(</span><span class="no">FILE_OUTPUT_PATH_PROPERTY</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">OutputStream</span> <span class="nf">getOutputStream</span><span class="o">(</span><span class="nc">JobConfig</span> <span class="n">config</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">JobExecution</span> <span class="n">jobExecution</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="na">getJobExecution</span><span class="o">();</span>

        <span class="nc">String</span> <span class="n">path</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">config</span><span class="o">.</span><span class="na">getConfigProperty</span><span class="o">(</span><span class="no">FILE_OUTPUT_PATH_PROPERTY</span><span class="o">);</span>

        <span class="n">jobExecution</span><span class="o">.</span><span class="na">getResults</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nf">FileOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">path</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div> <h3 id="interface-class"> <a href="#interface-class" class="anchor-heading" aria-labelledby="interface-class"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Interface class </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">DataOutputSink</span> <span class="kd">extends</span> <span class="nc">Configurable</span> <span class="o">{</span>

    <span class="nc">ExpressionParser</span> <span class="no">EXPRESSION_PARSER</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SpelExpressionParser</span><span class="o">();</span>

    <span class="kt">boolean</span> <span class="nf">accept</span><span class="o">(</span><span class="nc">FormatType</span> <span class="n">type</span><span class="o">);</span>

    <span class="k">default</span> <span class="kt">boolean</span> <span class="nf">flushable</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="k">default</span> <span class="nc">OutputStream</span> <span class="nf">getOutputStream</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">getOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">JobConfig</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nc">OutputStream</span> <span class="nf">getOutputStream</span><span class="o">(</span><span class="nc">JobConfig</span> <span class="n">config</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>

    <span class="k">default</span> <span class="nc">Object</span> <span class="nf">parseExpression</span><span class="o">(</span><span class="nc">String</span> <span class="n">expression</span><span class="o">,</span> <span class="nc">JobConfig</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">EvaluationContext</span> <span class="n">evaluationContext</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StandardEvaluationContext</span><span class="o">();</span>

        <span class="n">evaluationContext</span><span class="o">.</span><span class="na">setVariable</span><span class="o">(</span><span class="s">"dataset"</span><span class="o">,</span> <span class="n">config</span><span class="o">.</span><span class="na">getDataset</span><span class="o">());</span>
        <span class="n">evaluationContext</span><span class="o">.</span><span class="na">setVariable</span><span class="o">(</span><span class="s">"dataJob"</span><span class="o">,</span> <span class="n">config</span><span class="o">.</span><span class="na">getGenerateDataJob</span><span class="o">());</span>
        <span class="n">evaluationContext</span><span class="o">.</span><span class="na">setVariable</span><span class="o">(</span><span class="s">"jobExecution"</span><span class="o">,</span> <span class="n">config</span><span class="o">.</span><span class="na">getJobExecution</span><span class="o">());</span>

        <span class="nc">Expression</span> <span class="n">exp</span> <span class="o">=</span> <span class="no">EXPRESSION_PARSER</span><span class="o">.</span><span class="na">parseExpression</span><span class="o">(</span><span class="n">expression</span><span class="o">);</span>
        <span class="c1">//return exp.getValue();</span>
        <span class="k">return</span> <span class="n">exp</span><span class="o">.</span><span class="na">getValue</span><span class="o">(</span><span class="n">evaluationContext</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">default</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">SimpleFieldValue</span><span class="o">&gt;&gt;</span> <span class="nf">getRecords</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">inputStream</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectInputStream</span><span class="o">(</span><span class="n">inputStream</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">SimpleFieldValue</span><span class="o">&gt;&gt;)</span> <span class="n">in</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="k">default</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">SimpleFieldValue</span><span class="o">&gt;</span> <span class="nf">getRecord</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">inputStream</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectInputStream</span><span class="o">(</span><span class="n">inputStream</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">SimpleFieldValue</span><span class="o">&gt;)</span> <span class="n">in</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="k">default</span> <span class="nc">OutputStream</span> <span class="nf">encryptCompressStream</span><span class="o">(</span><span class="nc">JobConfig</span> <span class="n">config</span><span class="o">,</span> <span class="nc">OutputStream</span> <span class="n">outputStream</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">compressionFormat</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">config</span><span class="o">.</span><span class="na">getConfigProperty</span><span class="o">(</span><span class="nc">CompressFilter</span><span class="o">.</span><span class="na">COMPRESSION_FORMAT</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">encryptionAlgorithm</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">config</span><span class="o">.</span><span class="na">getConfigProperty</span><span class="o">(</span><span class="nc">EncryptFilter</span><span class="o">.</span><span class="na">ENCRYPTION_ALGORITHM</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="s">"NONE"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">compressionFormat</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="s">"NONE"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">encryptionAlgorithm</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">outputStream</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="s">"NONE"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">compressionFormat</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nc">EncryptFilter</span><span class="o">.</span><span class="na">encryptStream</span><span class="o">(</span><span class="n">config</span><span class="o">,</span> <span class="n">outputStream</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="s">"NONE"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">encryptionAlgorithm</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nc">CompressFilter</span><span class="o">.</span><span class="na">getCompressedStream</span><span class="o">(</span><span class="n">config</span><span class="o">,</span> <span class="n">outputStream</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nc">OutputStream</span> <span class="n">compressedStream</span> <span class="o">=</span> <span class="nc">CompressFilter</span><span class="o">.</span><span class="na">getCompressedStream</span><span class="o">(</span><span class="n">config</span><span class="o">,</span> <span class="n">outputStream</span><span class="o">);</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nf">OutputStream</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="nc">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteArrayOutputStream</span><span class="o">();</span>
            <span class="kd">final</span> <span class="nc">OutputStream</span> <span class="n">stream</span> <span class="o">=</span> <span class="nc">EncryptFilter</span><span class="o">.</span><span class="na">encryptStream</span><span class="o">(</span><span class="n">config</span><span class="o">,</span> <span class="n">baos</span><span class="o">);</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">write</span><span class="o">(</span><span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
                <span class="n">stream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">write</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
                <span class="n">stream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">write</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span><span class="o">,</span> <span class="kt">int</span> <span class="n">off</span><span class="o">,</span> <span class="kt">int</span> <span class="n">len</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
                <span class="n">stream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="n">off</span><span class="o">,</span> <span class="n">len</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">flush</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
                <span class="n">stream</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
                <span class="n">stream</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                <span class="n">stream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="n">compressedStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
                <span class="n">compressedStream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">};</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h1 id="field"> <a href="#field" class="anchor-heading" aria-labelledby="field"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Field </h1> <p>Dataset contains fields. A field generates a value based on it’s type.</p> <p>You must implement this method:</p> <p><code class="language-plaintext highlighter-rouge">protected abstract V generateData();</code></p> <p><code class="language-plaintext highlighter-rouge">List&lt;PropertyConfig&gt; getConfigProperties();</code></p> <h3 id="code-sample-2"> <a href="#code-sample-2" class="anchor-heading" aria-labelledby="code-sample-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Code sample </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">ca.breakpoints.datamaker.model.field.type</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.PropertyConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.field.Field</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.field.FieldGroup</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.field.FieldType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.collect.Lists</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ThreadLocalRandom</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.NoArgsConstructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.search.annotations.Indexed</span><span class="o">;</span>

<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Entity</span>
<span class="nd">@Indexed</span>
<span class="nd">@FieldType</span><span class="o">(</span><span class="n">description</span> <span class="o">=</span> <span class="s">"Age, Integer [1-100]"</span><span class="o">,</span> <span class="n">localizationKey</span> <span class="o">=</span> <span class="s">"field.group.age"</span><span class="o">,</span> <span class="n">group</span> <span class="o">=</span> <span class="nc">FieldGroup</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AgeField</span> <span class="kd">extends</span> <span class="nc">Field</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">static</span> <span class="kd">final</span> <span class="nc">PropertyConfig</span> <span class="no">MINIMUM_AGE_PROPERTY</span> <span class="o">=</span>
            <span class="k">new</span> <span class="nf">PropertyConfig</span><span class="o">(</span><span class="s">"field.age.minAge"</span><span class="o">,</span>
                               <span class="s">"Mininum age"</span><span class="o">,</span>
                               <span class="nc">PropertyConfig</span><span class="o">.</span><span class="na">ValueType</span><span class="o">.</span><span class="na">NUMERIC</span><span class="o">,</span>
                               <span class="mi">1</span><span class="o">,</span>
                               <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">125</span><span class="o">));</span>

    <span class="kd">static</span> <span class="kd">final</span> <span class="nc">PropertyConfig</span> <span class="no">MAXIMUM_AGE_PROPERTY</span> <span class="o">=</span>
            <span class="k">new</span> <span class="nf">PropertyConfig</span><span class="o">(</span><span class="s">"field.age.maxAge"</span><span class="o">,</span>
                               <span class="s">"Maximum age"</span><span class="o">,</span>
                               <span class="nc">PropertyConfig</span><span class="o">.</span><span class="na">ValueType</span><span class="o">.</span><span class="na">NUMERIC</span><span class="o">,</span>
                               <span class="mi">125</span><span class="o">,</span>
                               <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">125</span><span class="o">));</span>

    <span class="kd">public</span> <span class="nf">AgeField</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">generateData</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">minAge</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">config</span><span class="o">.</span><span class="na">getConfigProperty</span><span class="o">(</span><span class="no">MINIMUM_AGE_PROPERTY</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">maxAge</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">config</span><span class="o">.</span><span class="na">getConfigProperty</span><span class="o">(</span><span class="no">MAXIMUM_AGE_PROPERTY</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">maxAge</span> <span class="o">&lt;</span> <span class="n">minAge</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Maximum age should be greather than minimum age"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="nc">ThreadLocalRandom</span><span class="o">.</span><span class="na">current</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="n">minAge</span><span class="o">,</span>
                                            <span class="n">maxAge</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">PropertyConfig</span><span class="o">&gt;</span> <span class="nf">getConfigProperties</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">PropertyConfig</span><span class="o">&gt;</span> <span class="n">fieldConfigProperties</span> <span class="o">=</span> <span class="nc">Lists</span><span class="o">.</span><span class="na">newArrayList</span><span class="o">();</span>
        <span class="n">fieldConfigProperties</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="no">MINIMUM_AGE_PROPERTY</span><span class="o">);</span>
        <span class="n">fieldConfigProperties</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="no">MAXIMUM_AGE_PROPERTY</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">fieldConfigProperties</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div> <h3 id="base-class-1"> <a href="#base-class-1" class="anchor-heading" aria-labelledby="base-class-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Base class </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">ca.breakpoints.datamaker.model.field</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.Configurable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.PropertyConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.Searchable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.field.formatter.FieldFormatter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.field.type.NullField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.repository.FieldRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.service.BeanService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.service.EncryptionService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.service.FieldService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ai.datamaker.utils.FakerUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonProperty</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.github.javafaker.Faker</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.annotations.VisibleForTesting</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.collect.Lists</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.EqualsAndHashCode</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.ToString</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.collections.CollectionUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.StringUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Access</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.AccessType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.FetchType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Lob</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PostLoad</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PrePersist</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PreUpdate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Transient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotBlank</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.ParameterizedType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Type</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ThreadLocalRandom</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>

<span class="nd">@Data</span>
<span class="nd">@Entity</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Field</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="nc">Configurable</span><span class="o">,</span> <span class="nc">Serializable</span><span class="o">,</span> <span class="nc">Searchable</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">protected</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">search</span><span class="o">.</span><span class="na">annotations</span><span class="o">.</span><span class="na">Field</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">private</span> <span class="no">UUID</span> <span class="n">externalId</span><span class="o">;</span>

    <span class="c1">// Leave blank to generate random value</span>
    <span class="nd">@Lob</span>
    <span class="kd">protected</span> <span class="nc">FieldConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FieldConfig</span><span class="o">();</span>

    <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"dataset_id"</span><span class="o">)</span>
    <span class="nd">@ToString</span><span class="o">.</span><span class="na">Exclude</span>
    <span class="nd">@EqualsAndHashCode</span><span class="o">.</span><span class="na">Exclude</span>
    <span class="kd">private</span> <span class="nc">Dataset</span> <span class="n">dataset</span><span class="o">;</span>

    <span class="c1">// Defaults to workspace locale</span>
    <span class="c1">// The locale is used to format the data</span>
    <span class="c1">// Example: currency or even first name</span>
    <span class="c1">// If user select locale=FR and first name, the service will generate French's first name (Jean-Claude instead of Kevin)</span>
    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="nc">Locale</span> <span class="n">locale</span> <span class="o">=</span> <span class="nc">Locale</span><span class="o">.</span><span class="na">getDefault</span><span class="o">();</span>

    <span class="c1">// Column name, header</span>
    <span class="nd">@NotBlank</span>
    <span class="nd">@org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">search</span><span class="o">.</span><span class="na">annotations</span><span class="o">.</span><span class="na">Field</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">search</span><span class="o">.</span><span class="na">annotations</span><span class="o">.</span><span class="na">Field</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Boolean</span> <span class="n">isNullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">nullValue</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>

    <span class="nd">@Transient</span>
    <span class="kd">protected</span> <span class="nc">FieldFormatter</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">formatter</span><span class="o">;</span>

    <span class="nd">@Access</span><span class="o">(</span><span class="nc">AccessType</span><span class="o">.</span><span class="na">PROPERTY</span><span class="o">)</span>
    <span class="nd">@org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">search</span><span class="o">.</span><span class="na">annotations</span><span class="o">.</span><span class="na">Field</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">formatterClassName</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">position</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

    <span class="c1">// Use for XML formatting or else...</span>
    <span class="kd">private</span> <span class="nc">Boolean</span> <span class="n">isAttribute</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Boolean</span> <span class="n">isAlias</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

    <span class="kd">protected</span> <span class="nc">Boolean</span> <span class="n">isPrimaryKey</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Boolean</span> <span class="n">isNested</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Date</span> <span class="n">dateCreated</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>

    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="nc">JsonProperty</span><span class="o">.</span><span class="na">Access</span><span class="o">.</span><span class="na">READ_ONLY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Date</span> <span class="n">dateModified</span><span class="o">;</span>

    <span class="nd">@Transient</span>
    <span class="kd">private</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">objectType</span><span class="o">;</span>

    <span class="nd">@Transient</span>
    <span class="nd">@org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">search</span><span class="o">.</span><span class="na">annotations</span><span class="o">.</span><span class="na">Field</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">className</span> <span class="o">=</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">();</span>

    <span class="nd">@Transient</span>
    <span class="kd">protected</span> <span class="kd">transient</span> <span class="nc">Faker</span> <span class="n">faker</span><span class="o">;</span>

    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nf">Field</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">externalId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">faker</span> <span class="o">=</span> <span class="nc">FakerUtils</span><span class="o">.</span><span class="na">getFakerForLocale</span><span class="o">(</span><span class="n">locale</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">getGenericSuperclass</span><span class="o">()</span> <span class="k">instanceof</span> <span class="nc">ParameterizedType</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Type</span> <span class="n">pt</span> <span class="o">=</span> <span class="o">((</span><span class="nc">ParameterizedType</span><span class="o">)</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getGenericSuperclass</span><span class="o">()).</span><span class="na">getActualTypeArguments</span><span class="o">()[</span><span class="mi">0</span><span class="o">];</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">pt</span> <span class="k">instanceof</span> <span class="nc">ParameterizedType</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">objectType</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;)</span> <span class="o">((</span><span class="nc">ParameterizedType</span><span class="o">)</span> <span class="n">pt</span><span class="o">).</span><span class="na">getRawType</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">objectType</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;)</span> <span class="n">pt</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">objectType</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;)</span> <span class="nc">Class</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">this</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">setField</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nf">Field</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">locale</span> <span class="o">=</span> <span class="n">locale</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">externalId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">faker</span> <span class="o">=</span> <span class="nc">FakerUtils</span><span class="o">.</span><span class="na">getFakerForLocale</span><span class="o">(</span><span class="n">locale</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">getGenericSuperclass</span><span class="o">()</span> <span class="k">instanceof</span> <span class="nc">ParameterizedType</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Type</span> <span class="n">pt</span> <span class="o">=</span> <span class="o">((</span><span class="nc">ParameterizedType</span><span class="o">)</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getGenericSuperclass</span><span class="o">()).</span><span class="na">getActualTypeArguments</span><span class="o">()[</span><span class="mi">0</span><span class="o">];</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">pt</span> <span class="k">instanceof</span> <span class="nc">ParameterizedType</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">objectType</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;)</span> <span class="o">((</span><span class="nc">ParameterizedType</span><span class="o">)</span> <span class="n">pt</span><span class="o">).</span><span class="na">getRawType</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">objectType</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;)</span> <span class="n">pt</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">objectType</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;)</span> <span class="nc">Class</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">this</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">setField</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="no">V</span> <span class="nf">generateData</span><span class="o">();</span>

    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">getData</span><span class="o">()</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">isNullable</span> <span class="o">&amp;&amp;</span> <span class="n">dataset</span><span class="o">.</span><span class="na">getNullablePercentLimit</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Generate random null 10% of time (max)</span>
            <span class="k">if</span> <span class="o">(</span><span class="nc">ThreadLocalRandom</span><span class="o">.</span><span class="na">current</span><span class="o">().</span><span class="na">nextFloat</span><span class="o">()</span> <span class="o">&lt;=</span> <span class="n">dataset</span><span class="o">.</span><span class="na">getNullablePercentLimit</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="no">V</span> <span class="n">value</span> <span class="o">=</span> <span class="n">generateData</span><span class="o">();</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">formatter</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">formatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">config</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLocale</span><span class="o">(</span><span class="nc">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">locale</span> <span class="o">=</span> <span class="n">locale</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">faker</span> <span class="o">=</span> <span class="nc">FakerUtils</span><span class="o">.</span><span class="na">getFakerForLocale</span><span class="o">(</span><span class="n">locale</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getFormatterClassName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">formatterClassName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFormatterClassName</span><span class="o">(</span><span class="nc">String</span> <span class="n">formatterClass</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isNotBlank</span><span class="o">(</span><span class="n">formatterClass</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">formatterClassName</span> <span class="o">=</span> <span class="n">formatterClass</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">formatter</span> <span class="o">=</span> <span class="o">(</span><span class="nc">FieldFormatter</span><span class="o">)</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">formatterClass</span><span class="o">).</span><span class="na">getDeclaredConstructor</span><span class="o">().</span><span class="na">newInstance</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span> <span class="n">e</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>


    <span class="nd">@VisibleForTesting</span>
    <span class="kd">protected</span> <span class="nc">Field</span> <span class="nf">getFieldFor</span><span class="o">(</span><span class="nc">String</span> <span class="n">externalId</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">FieldService</span> <span class="n">fieldService</span> <span class="o">=</span> <span class="nc">BeanService</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">FieldService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">fieldService</span><span class="o">.</span><span class="na">getFieldFor</span><span class="o">(</span><span class="n">externalId</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getTags</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="nc">NullField</span> <span class="nf">createNull</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">NullField</span> <span class="n">nullField</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NullField</span><span class="o">(</span><span class="s">"null"</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
        <span class="n">nullField</span><span class="o">.</span><span class="na">setDataset</span><span class="o">(</span><span class="n">dataset</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">nullField</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div> <h1 id="generator"> <a href="#generator" class="anchor-heading" aria-labelledby="generator"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Generator </h1> <p>A generator implementation will generate data based on a dataset definition.</p> <p>You need to implement the following method:</p> <p><code class="language-plaintext highlighter-rouge">void generate(Dataset dataset, OutputStream outputStream) throws Exception;</code></p> <h3 id="code-sample-3"> <a href="#code-sample-3" class="anchor-heading" aria-labelledby="code-sample-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Code sample </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">ca.breakpoints.datamaker.generator</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.JobConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.PropertyConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ca.breakpoints.datamaker.model.PropertyConfig.ValueType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.collect.Lists</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TextGenerator</span> <span class="kd">implements</span> <span class="nc">DataGenerator</span> <span class="o">{</span>

    <span class="kd">static</span> <span class="kd">final</span> <span class="nc">PropertyConfig</span> <span class="no">ELEMENT_SEPARATOR</span> <span class="o">=</span>
        <span class="k">new</span> <span class="nf">PropertyConfig</span><span class="o">(</span><span class="s">"text.generator.element.separator"</span><span class="o">,</span>
            <span class="s">"Element separator"</span><span class="o">,</span>
            <span class="nc">PropertyConfig</span><span class="o">.</span><span class="na">ValueType</span><span class="o">.</span><span class="na">STRING</span><span class="o">,</span>
            <span class="s">""</span><span class="o">,</span>
            <span class="nc">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">());</span>

    <span class="kd">static</span> <span class="kd">final</span> <span class="nc">PropertyConfig</span> <span class="no">KEY_VALUE_SEPARATOR</span> <span class="o">=</span>
        <span class="k">new</span> <span class="nf">PropertyConfig</span><span class="o">(</span><span class="s">"text.generator.key.value.separator"</span><span class="o">,</span>
            <span class="s">"Key value separator"</span><span class="o">,</span>
            <span class="nc">PropertyConfig</span><span class="o">.</span><span class="na">ValueType</span><span class="o">.</span><span class="na">STRING</span><span class="o">,</span>
            <span class="s">"="</span><span class="o">,</span>
            <span class="nc">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">());</span>

    <span class="kd">static</span> <span class="kd">final</span> <span class="nc">PropertyConfig</span> <span class="no">OUTPUT_KEYS</span> <span class="o">=</span>
        <span class="k">new</span> <span class="nf">PropertyConfig</span><span class="o">(</span><span class="s">"text.generator.output.keys"</span><span class="o">,</span>
            <span class="s">"Output keys"</span><span class="o">,</span>
            <span class="nc">ValueType</span><span class="o">.</span><span class="na">BOOLEAN</span><span class="o">,</span>
            <span class="s">"false"</span><span class="o">,</span>
            <span class="nc">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">());</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generate</span><span class="o">(</span><span class="nc">Dataset</span> <span class="n">dataset</span><span class="o">,</span> <span class="nc">OutputStream</span> <span class="n">outputStream</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">generate</span><span class="o">(</span><span class="n">dataset</span><span class="o">,</span> <span class="n">outputStream</span><span class="o">,</span> <span class="nc">JobConfig</span><span class="o">.</span><span class="na">EMPTY</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generate</span><span class="o">(</span><span class="nc">Dataset</span> <span class="n">dataset</span><span class="o">,</span> <span class="nc">OutputStream</span> <span class="n">outputStream</span><span class="o">,</span> <span class="nc">JobConfig</span> <span class="n">config</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">dataset</span><span class="o">.</span><span class="na">processAllValues</span><span class="o">(</span><span class="n">fv</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">fv</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">value</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="k">if</span> <span class="o">(</span><span class="nc">Boolean</span><span class="o">.</span><span class="na">parseBoolean</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="na">getConfigProperty</span><span class="o">(</span><span class="no">OUTPUT_KEYS</span><span class="o">).</span><span class="na">toString</span><span class="o">()))</span> <span class="o">{</span>
                            <span class="n">outputStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">getField</span><span class="o">().</span><span class="na">getName</span><span class="o">().</span><span class="na">getBytes</span><span class="o">());</span>
                            <span class="n">outputStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="na">getConfigProperty</span><span class="o">(</span><span class="no">KEY_VALUE_SEPARATOR</span><span class="o">).</span><span class="na">toString</span><span class="o">().</span><span class="na">getBytes</span><span class="o">());</span>
                        <span class="o">}</span>
                        <span class="n">outputStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">getBytes</span><span class="o">());</span>
                        <span class="n">outputStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="na">getConfigProperty</span><span class="o">(</span><span class="no">ELEMENT_SEPARATOR</span><span class="o">).</span><span class="na">toString</span><span class="o">().</span><span class="na">getBytes</span><span class="o">());</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">);</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">FormatType</span> <span class="nf">getDataType</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">FormatType</span><span class="o">.</span><span class="na">TEXT</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">PropertyConfig</span><span class="o">&gt;</span> <span class="nf">getConfigProperties</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Lists</span><span class="o">.</span><span class="na">newArrayList</span><span class="o">(</span><span class="no">ELEMENT_SEPARATOR</span><span class="o">,</span> <span class="no">KEY_VALUE_SEPARATOR</span><span class="o">,</span> <span class="no">OUTPUT_KEYS</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div> <h3 id="interface-class-1"> <a href="#interface-class-1" class="anchor-heading" aria-labelledby="interface-class-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Interface class </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Generate data based on a dataset.
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">DataGenerator</span> <span class="kd">extends</span> <span class="nc">Configurable</span> <span class="o">{</span>

    <span class="nc">ExpressionParser</span> <span class="no">EXPRESSION_PARSER</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SpelExpressionParser</span><span class="o">();</span>

    <span class="kt">void</span> <span class="nf">generate</span><span class="o">(</span><span class="nc">Dataset</span> <span class="n">dataset</span><span class="o">,</span> <span class="nc">OutputStream</span> <span class="n">outputStream</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>

    <span class="k">default</span> <span class="kt">void</span> <span class="nf">generate</span><span class="o">(</span><span class="nc">Dataset</span> <span class="n">dataset</span><span class="o">,</span> <span class="nc">OutputStream</span> <span class="n">outputStream</span><span class="o">,</span> <span class="nc">JobConfig</span> <span class="n">config</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">generate</span><span class="o">(</span><span class="n">dataset</span><span class="o">,</span> <span class="n">outputStream</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nc">FormatType</span> <span class="nf">getDataType</span><span class="o">();</span>

    <span class="k">default</span> <span class="nc">Object</span> <span class="nf">parseExpression</span><span class="o">(</span><span class="nc">String</span> <span class="n">expression</span><span class="o">,</span> <span class="nc">Dataset</span> <span class="n">dataset</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">EvaluationContext</span> <span class="n">evaluationContext</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StandardEvaluationContext</span><span class="o">();</span>

        <span class="n">evaluationContext</span><span class="o">.</span><span class="na">setVariable</span><span class="o">(</span><span class="s">"dataset"</span><span class="o">,</span> <span class="n">dataset</span><span class="o">);</span>
        <span class="c1">// evaluationContext.setVariable("dataJob", config.getGenerateDataJob());</span>
        <span class="c1">// evaluationContext.setVariable("jobExecution", config.getJobExecution());</span>

        <span class="nc">Expression</span> <span class="n">exp</span> <span class="o">=</span> <span class="no">EXPRESSION_PARSER</span><span class="o">.</span><span class="na">parseExpression</span><span class="o">(</span><span class="n">expression</span><span class="o">);</span>
        <span class="c1">//return exp.getValue();</span>
        <span class="k">return</span> <span class="n">exp</span><span class="o">.</span><span class="na">getValue</span><span class="o">(</span><span class="n">evaluationContext</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2022 Datamaker Inc.</p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
